<div class="container">
  <div class="row">
    <h2>サイクルスポット</h2>
    <div class="col-10 mb-3">
      <div>
        <% if @post.user.id == current_user.id %>
          <%=  link_to "編集", edit_post_path(@post), class:"btn btn-outline-secondary"%>
        <% end %>
      </div>
      <div class="post_image">
        <%= attachment_image_tag @post, :image, fallback: "no_image.jpg", class:"img-fluid" %>
      </div>
      <p class=""><%= @post.updated_at.strftime('%Y/%m/%d') %></p>
    </div>
  </div>
  <div class="row">
    <div class="col-10 mb-3">
      <div><%= @post.genre %></div>
      <h3><%= @post.title %></h3>
      <p><%= @post.prefecture.name %>/<%= @post.place %></p>
      <div>
        <%= attachment_image_tag @post.user, :profile_image, size: "100x100", fallback: "no_image.jpg",class:"rounded-circle" %>
        <%= @post.user.nickname %>
      </div>
      <div id="thanks-btn_<%= @post.id %>">
        <%= render "user/thanks/thanks-btn", post: @post %>
      </div>
      <div class="border py-3">
        <%= @post.explanation %>
      </div>
      <table class="table">
        <tbody class="table-light">
          <tr>
            <td>〒</td>
            <td><%= @post.address %></td>
          </tr>
          <tr>
            <td>タグ</td>
            <td>
              <% @post_tags.each do |tag| %>
                <span>#<%= tag.name %></span>
              <% end %>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="col-10 mb-3">
      <div class="border">
        <!--地図-->
        <div id="map"></div>
        <style>
          #map{
              height: 200px;
          }
        </style>
        <script type="text/javascript">
          function initMap() {
            var latlng ={lat: <%= @post.latitude %>, lng: <%= @post.longitude %>};
            var map = new google.maps.Map(document.getElementById('map'), {
              zoom: 13, 
              center: latlng
            });
            var bikeLayer = new google.maps.BicyclingLayer();
            bikeLayer.setMap(map);
            
            var marker = new google.maps.Marker({
              position:latlng,
              map: map,
            });
            
             marker.addListener('click', function() {
               infowindow.open(map, marker);
             });
          } 
        </script>
        <script async defer
          src="https://maps.googleapis.com/maps/api/js?v=3.exp&key=<%= ENV['GOOGLE_MAP_API_KEY'] %>&callback=initMap">
        </script>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-10 mb-3">
      <h3>コメント投稿フォーム</h3>
      <div>
        <%= form_with(model:[@post, @post_comment], local: true) do |f| %>
          <div>
            <%= f.text_area :comment, rows:'4', class:"form-control" %>
          </div>
          <div>
            <%= f.submit "コメント投稿", class:'btn btn-secondary mt-3' %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-10 mb-3">
      <h3>コメント一覧<span><%= "#{@post.post_comments.count}件" %></span></h3>
      <ul>
        <% @post.post_comments.each do |post_comment| %>
          <li>
            <div class="row">
              <div class="col-2 mb-3">
                <%= link_to user_path(post_comment.user.id) %>
                  <%= attachment_image_tag post_comment.user, :profile_image, size: "50x50", fallback: "no_image.jpg", class:"rounded-circle" %>
                  <%= post_comment.user.nickname %>
                <% end %>
              </div>
              <div class="col-8 mb-3 comment-box">
                <%= post_comment.comment %>
              </div>
              <div class="col-2 mb-3">
                <% if post_comment.user == current_user %>
                  <%= link_to "削除", post_post_comment_path(post_comment.post, post_comment), method: :delete, class:"btn btn-danger" %>
                <% end %>
              </div>
            </div>
          </li>
        <% end %>
      </ul>
    </div>
  </div>
</div>